<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Building and validating semi-spatial GAMs for climate | Colonial-era landscape changes are concomitant with grassland bird species declines over the last century</title>
  <meta name="description" content="Section 3 Building and validating semi-spatial GAMs for climate | Colonial-era landscape changes are concomitant with grassland bird species declines over the last century" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Building and validating semi-spatial GAMs for climate | Colonial-era landscape changes are concomitant with grassland bird species declines over the last century" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="vjjan91/nilgiris-resurvey-project" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Building and validating semi-spatial GAMs for climate | Colonial-era landscape changes are concomitant with grassland bird species declines over the last century" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Priyanka Hari Haran" />
<meta name="author" content="Pratik Rajan Gupte" />
<meta name="author" content="Ashwini V. Mohan" />
<meta name="author" content="VA Akshay" />
<meta name="author" content="Amrutha Rajan" />
<meta name="author" content="Chandrasekar Das" />
<meta name="author" content="Ian Lockwood" />
<meta name="author" content="VV Robin" />
<meta name="author" content="Morgan W Tingley" />
<meta name="author" content="Ruth S DeFries" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preparing-historical-climate-data-and-geographical-covariates.html"/>
<link rel="next" href="building-a-correction-layer-for-climate-predictions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html"><i class="fa fa-check"></i><b>2</b> Preparing historical climate data and geographical covariates</a>
<ul>
<li class="chapter" data-level="2.1" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#load-libraries"><i class="fa fa-check"></i><b>2.1</b> Load libraries</a></li>
<li class="chapter" data-level="2.2" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#reading-raw-historical-climate-data"><i class="fa fa-check"></i><b>2.2</b> Reading raw historical climate data</a></li>
<li class="chapter" data-level="2.3" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#summarising-historical-climate-data"><i class="fa fa-check"></i><b>2.3</b> Summarising historical climate data</a></li>
<li class="chapter" data-level="2.4" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#prepare-study-area-spatial-extent"><i class="fa fa-check"></i><b>2.4</b> Prepare study area spatial extent</a></li>
<li class="chapter" data-level="2.5" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#prepare-spatial-data-for-the-study-area"><i class="fa fa-check"></i><b>2.5</b> Prepare spatial data for the study area</a></li>
<li class="chapter" data-level="2.6" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#elevation-data"><i class="fa fa-check"></i><b>2.6</b> Elevation data</a></li>
<li class="chapter" data-level="2.7" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#distance-to-coast-data"><i class="fa fa-check"></i><b>2.7</b> Distance to coast data</a></li>
<li class="chapter" data-level="2.8" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#latitude-data"><i class="fa fa-check"></i><b>2.8</b> Latitude data</a></li>
<li class="chapter" data-level="2.9" data-path="preparing-historical-climate-data-and-geographical-covariates.html"><a href="preparing-historical-climate-data-and-geographical-covariates.html#link-predictors-to-climate-data"><i class="fa fa-check"></i><b>2.9</b> Link predictors to climate data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html"><i class="fa fa-check"></i><b>3</b> Building and validating semi-spatial GAMs for climate</a>
<ul>
<li class="chapter" data-level="3.1" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#load-libraries-1"><i class="fa fa-check"></i><b>3.1</b> Load libraries</a></li>
<li class="chapter" data-level="3.2" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#prepare-linked-climate-spatial-data-and-spatial-data-for-modelling"><i class="fa fa-check"></i><b>3.2</b> Prepare linked climate-spatial data and spatial data for modelling</a></li>
<li class="chapter" data-level="3.3" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#fit-candidate-spatial-climate-models"><i class="fa fa-check"></i><b>3.3</b> Fit candidate spatial-climate models</a></li>
<li class="chapter" data-level="3.4" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#model-predictions-for-modern-climate"><i class="fa fa-check"></i><b>3.4</b> Model predictions for modern climate</a></li>
<li class="chapter" data-level="3.5" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#average-predictions-over-1970-to-2010"><i class="fa fa-check"></i><b>3.5</b> Average predictions over 1970 to 2010</a></li>
<li class="chapter" data-level="3.6" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#get-bioclim-data"><i class="fa fa-check"></i><b>3.6</b> Get BIOCLIM data</a></li>
<li class="chapter" data-level="3.7" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#temperature-data"><i class="fa fa-check"></i><b>3.7</b> Temperature data</a></li>
<li class="chapter" data-level="3.8" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#precipitation-data"><i class="fa fa-check"></i><b>3.8</b> Precipitation data</a></li>
<li class="chapter" data-level="3.9" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#compare-spatial-climate-model-predictions-against-bioclim-data"><i class="fa fa-check"></i><b>3.9</b> Compare spatial-climate model predictions against BIOCLIM data</a></li>
<li class="chapter" data-level="3.10" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#sample-locations"><i class="fa fa-check"></i><b>3.10</b> Sample locations</a></li>
<li class="chapter" data-level="3.11" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#link-bioclim-data-and-model-predictions"><i class="fa fa-check"></i><b>3.11</b> Link BIOCLIM data and model predictions</a></li>
<li class="chapter" data-level="3.12" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#error-between-model-prediction-and-chelsa-data"><i class="fa fa-check"></i><b>3.12</b> Error between model prediction and CHELSA data</a></li>
<li class="chapter" data-level="3.13" data-path="building-and-validating-semi-spatial-gams-for-climate.html"><a href="building-and-validating-semi-spatial-gams-for-climate.html#gam-predictions-at-survey-sites"><i class="fa fa-check"></i><b>3.13</b> GAM predictions at survey sites</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html"><i class="fa fa-check"></i><b>4</b> Building a correction layer for climate predictions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#load-libraries-2"><i class="fa fa-check"></i><b>4.1</b> Load libraries</a></li>
<li class="chapter" data-level="4.2" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#plot-model-error"><i class="fa fa-check"></i><b>4.2</b> Plot model error</a></li>
<li class="chapter" data-level="4.3" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#compare-climate-predictions-at-survey-sites"><i class="fa fa-check"></i><b>4.3</b> Compare climate predictions at survey sites</a></li>
<li class="chapter" data-level="4.4" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#visualise-model-predictions-as-proportion-of-remote-sensing-data"><i class="fa fa-check"></i><b>4.4</b> Visualise model predictions as proportion of remote sensing data</a></li>
<li class="chapter" data-level="4.5" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#temperature-scaling-layer"><i class="fa fa-check"></i><b>4.5</b> Temperature scaling layer</a></li>
<li class="chapter" data-level="4.6" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#precipitation-scaling-layer"><i class="fa fa-check"></i><b>4.6</b> Precipitation scaling layer</a></li>
<li class="chapter" data-level="4.7" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#save-climate-scaling-layers"><i class="fa fa-check"></i><b>4.7</b> Save climate scaling layers</a></li>
<li class="chapter" data-level="4.8" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#seasonal-mean-temperature-correction-layer"><i class="fa fa-check"></i><b>4.8</b> Seasonal mean temperature correction layer</a></li>
<li class="chapter" data-level="4.9" data-path="building-a-correction-layer-for-climate-predictions.html"><a href="building-a-correction-layer-for-climate-predictions.html#seasonal-total-rainfall-correction-layer"><i class="fa fa-check"></i><b>4.9</b> Seasonal total rainfall correction layer</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modelling-historical-climate-over-the-study-area.html"><a href="modelling-historical-climate-over-the-study-area.html"><i class="fa fa-check"></i><b>5</b> Modelling historical climate over the study area</a>
<ul>
<li class="chapter" data-level="5.1" data-path="modelling-historical-climate-over-the-study-area.html"><a href="modelling-historical-climate-over-the-study-area.html#load-libraries-3"><i class="fa fa-check"></i><b>5.1</b> Load libraries</a></li>
<li class="chapter" data-level="5.2" data-path="modelling-historical-climate-over-the-study-area.html"><a href="modelling-historical-climate-over-the-study-area.html#read-in-data"><i class="fa fa-check"></i><b>5.2</b> Read in data</a></li>
<li class="chapter" data-level="5.3" data-path="modelling-historical-climate-over-the-study-area.html"><a href="modelling-historical-climate-over-the-study-area.html#model-climate-as-a-function-of-geographic-variables"><i class="fa fa-check"></i><b>5.3</b> Model climate as a function of geographic variables</a></li>
<li class="chapter" data-level="5.4" data-path="modelling-historical-climate-over-the-study-area.html"><a href="modelling-historical-climate-over-the-study-area.html#obtaining-model-predictions-over-the-study-area"><i class="fa fa-check"></i><b>5.4</b> Obtaining model predictions over the study area</a></li>
<li class="chapter" data-level="5.5" data-path="modelling-historical-climate-over-the-study-area.html"><a href="modelling-historical-climate-over-the-study-area.html#scaling-predicted-historical-climate"><i class="fa fa-check"></i><b>5.5</b> Scaling predicted historical climate</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html"><i class="fa fa-check"></i><b>6</b> Analyzing temperature and precipitation change over time</a>
<ul>
<li class="chapter" data-level="6.1" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html#load-necessary-libraries"><i class="fa fa-check"></i><b>6.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="6.2" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html#plot-change-in-climate-as-percentages."><i class="fa fa-check"></i><b>6.2</b> Plot change in climate as percentages.</a></li>
<li class="chapter" data-level="6.3" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html#load-list-of-resurvey-locationshistorical-sites-of-occurrence"><i class="fa fa-check"></i><b>6.3</b> Load list of resurvey locations/historical sites of occurrence</a></li>
<li class="chapter" data-level="6.4" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html#load-the-climate-rasters"><i class="fa fa-check"></i><b>6.4</b> Load the climate rasters</a></li>
<li class="chapter" data-level="6.5" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html#combine-site-climate-and-terrain-data"><i class="fa fa-check"></i><b>6.5</b> Combine site climate and terrain data</a></li>
<li class="chapter" data-level="6.6" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html#plot-all-reconstructed-climate-over-time-colouring-by-elevation-and-grouping-by-site.-each-line-represents-one-modern-site-code."><i class="fa fa-check"></i><b>6.6</b> Plot all reconstructed climate over time colouring by elevation and grouping by site. Each line represents one modern site code.</a></li>
<li class="chapter" data-level="6.7" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html#alternative-figure-for-temperature-change-over-time"><i class="fa fa-check"></i><b>6.7</b> Alternative figure for temperature change over time</a></li>
<li class="chapter" data-level="6.8" data-path="analyzing-temperature-and-precipitation-change-over-time.html"><a href="analyzing-temperature-and-precipitation-change-over-time.html#test-for-climate-change-over-time"><i class="fa fa-check"></i><b>6.8</b> Test for climate change over time</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html"><i class="fa fa-check"></i><b>7</b> Land cover classification and change detection</a>
<ul>
<li class="chapter" data-level="7.1" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#load-necessary-libraries-1"><i class="fa fa-check"></i><b>7.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="7.2" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#processing-digitized-shapefiles-from-the-1848-map"><i class="fa fa-check"></i><b>7.2</b> Processing digitized shapefiles from the 1848 map</a></li>
<li class="chapter" data-level="7.3" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#rasterization-of-the-1848-shapefiles"><i class="fa fa-check"></i><b>7.3</b> Rasterization of the 1848 shapefiles</a></li>
<li class="chapter" data-level="7.4" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#load-the-2018-satellite-image"><i class="fa fa-check"></i><b>7.4</b> Load the 2018 satellite image</a></li>
<li class="chapter" data-level="7.5" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#subsume-plantations-into-one-category-for-2018"><i class="fa fa-check"></i><b>7.5</b> Subsume plantations into one category for 2018</a></li>
<li class="chapter" data-level="7.6" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#write-the-shapefiles-and-rasters-to-file"><i class="fa fa-check"></i><b>7.6</b> Write the shapefiles and rasters to file</a></li>
<li class="chapter" data-level="7.7" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#area-wise-comparisons-of-land-cover-change"><i class="fa fa-check"></i><b>7.7</b> Area-wise comparisons of land cover change</a></li>
<li class="chapter" data-level="7.8" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#barplots-of-land-cover-change"><i class="fa fa-check"></i><b>7.8</b> Barplots of land cover change</a></li>
<li class="chapter" data-level="7.9" data-path="land-cover-classification-and-change-detection.html"><a href="land-cover-classification-and-change-detection.html#validating-the-2018-sentinel-2-classification"><i class="fa fa-check"></i><b>7.9</b> Validating the 2018 Sentinel-2 classification</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html"><i class="fa fa-check"></i><b>8</b> Grassland contractions &amp; forest expansions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html#load-necessary-libraries-2"><i class="fa fa-check"></i><b>8.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="8.2" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html#load-processed-land-cover-rasters"><i class="fa fa-check"></i><b>8.2</b> Load processed land cover rasters</a></li>
<li class="chapter" data-level="8.3" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html#visualize-forests-across-the-two-time-periods"><i class="fa fa-check"></i><b>8.3</b> Visualize forests across the two time periods</a></li>
<li class="chapter" data-level="8.4" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html#visualize-grassland-area-across-the-two-time-periods"><i class="fa fa-check"></i><b>8.4</b> Visualize grassland area across the two time periods</a></li>
<li class="chapter" data-level="8.5" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html#comparing-if-forests-have-increased-in-locations-where-grasslands-were-formerly-found"><i class="fa fa-check"></i><b>8.5</b> Comparing if forests have increased in locations where grasslands were formerly found?</a></li>
<li class="chapter" data-level="8.6" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html#have-forests-expanded-across-elevations"><i class="fa fa-check"></i><b>8.6</b> Have forests expanded across elevations?</a></li>
<li class="chapter" data-level="8.7" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html#how-do-grassland-patches-vary-by-elevation-across-time-periods"><i class="fa fa-check"></i><b>8.7</b> How do grassland patches vary by elevation across time periods?</a></li>
<li class="chapter" data-level="8.8" data-path="grassland-contractions-forest-expansions.html"><a href="grassland-contractions-forest-expansions.html#comparing-if-plantations-have-increased-in-locations-where-grasslands-were-formerly-found"><i class="fa fa-check"></i><b>8.8</b> Comparing if plantations have increased in locations where grasslands were formerly found?</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html"><i class="fa fa-check"></i><b>9</b> Visualizing time series of change</a>
<ul>
<li class="chapter" data-level="9.1" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#load-necessary-libraries-3"><i class="fa fa-check"></i><b>9.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="9.2" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#load-processed-land-cover-rasters-1"><i class="fa fa-check"></i><b>9.2</b> Load processed land cover rasters</a></li>
<li class="chapter" data-level="9.3" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#loading-data-from-the-1910-map"><i class="fa fa-check"></i><b>9.3</b> Loading data from the 1910 map</a></li>
<li class="chapter" data-level="9.4" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#rasterizing-of-the-1910-data"><i class="fa fa-check"></i><b>9.4</b> Rasterizing of the 1910 data</a></li>
<li class="chapter" data-level="9.5" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#loading-the-1973-and-1995-data"><i class="fa fa-check"></i><b>9.5</b> Loading the 1973 and 1995 data</a></li>
<li class="chapter" data-level="9.6" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#rasterization-of-the-1973-and-1995-data"><i class="fa fa-check"></i><b>9.6</b> Rasterization of the 1973 and 1995 data</a></li>
<li class="chapter" data-level="9.7" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#visualization-of-landscape-change-over-time"><i class="fa fa-check"></i><b>9.7</b> Visualization of landscape change over time</a></li>
<li class="chapter" data-level="9.8" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#subsume-plantations-into-one-category-for-1973-1995-and-2018"><i class="fa fa-check"></i><b>9.8</b> Subsume plantations into one category for 1973, 1995, and 2018</a></li>
<li class="chapter" data-level="9.9" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#creating-smaller-regions-of-interest-for-comparison"><i class="fa fa-check"></i><b>9.9</b> Creating smaller regions of interest for comparison</a></li>
<li class="chapter" data-level="9.10" data-path="visualizing-time-series-of-change.html"><a href="visualizing-time-series-of-change.html#comparisons-only-above-1400-meters-in-elevation"><i class="fa fa-check"></i><b>9.10</b> Comparisons only above 1400 meters in elevation</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="exploratory-analysis-of-occurrence-data.html"><a href="exploratory-analysis-of-occurrence-data.html"><i class="fa fa-check"></i><b>10</b> Exploratory analysis of occurrence data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="exploratory-analysis-of-occurrence-data.html"><a href="exploratory-analysis-of-occurrence-data.html#load-necessary-libraries-4"><i class="fa fa-check"></i><b>10.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="10.2" data-path="exploratory-analysis-of-occurrence-data.html"><a href="exploratory-analysis-of-occurrence-data.html#load-the-historical-occurrence-data-and-explore-patterns"><i class="fa fa-check"></i><b>10.2</b> Load the historical occurrence data and explore patterns</a></li>
<li class="chapter" data-level="10.3" data-path="exploratory-analysis-of-occurrence-data.html"><a href="exploratory-analysis-of-occurrence-data.html#examining-historical-data-by-locality"><i class="fa fa-check"></i><b>10.3</b> Examining historical data by locality</a></li>
<li class="chapter" data-level="10.4" data-path="exploratory-analysis-of-occurrence-data.html"><a href="exploratory-analysis-of-occurrence-data.html#visualizations-of-historical-data"><i class="fa fa-check"></i><b>10.4</b> Visualizations of historical data</a></li>
<li class="chapter" data-level="10.5" data-path="exploratory-analysis-of-occurrence-data.html"><a href="exploratory-analysis-of-occurrence-data.html#examining-species-specific-counts-by-locality"><i class="fa fa-check"></i><b>10.5</b> Examining species specific counts by locality</a></li>
<li class="chapter" data-level="10.6" data-path="exploratory-analysis-of-occurrence-data.html"><a href="exploratory-analysis-of-occurrence-data.html#load-modern-occurrence-data-and-explore-patterns"><i class="fa fa-check"></i><b>10.6</b> Load modern occurrence data and explore patterns</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html"><i class="fa fa-check"></i><b>11</b> Species relative abundances over time</a>
<ul>
<li class="chapter" data-level="11.1" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#load-necessary-libraries-5"><i class="fa fa-check"></i><b>11.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="11.2" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#load-list-of-resurvey-locations"><i class="fa fa-check"></i><b>11.2</b> Load list of resurvey locations</a></li>
<li class="chapter" data-level="11.3" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#calibrating-historical-data-to-modern-survey-data-for-relative-abundance-calculations"><i class="fa fa-check"></i><b>11.3</b> Calibrating historical data to modern survey data for relative abundance calculations</a></li>
<li class="chapter" data-level="11.4" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#calculating-species-relative-abundance-for-the-historical-data-1850-1900-and-1900-1950"><i class="fa fa-check"></i><b>11.4</b> Calculating species relative abundance for the historical data (1850-1900 and 1900-1950)</a></li>
<li class="chapter" data-level="11.5" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#load-the-modern-occurrence-data"><i class="fa fa-check"></i><b>11.5</b> Load the modern occurrence data</a></li>
<li class="chapter" data-level="11.6" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#calculate-dirichlet-distributions-of-relative-abundance"><i class="fa fa-check"></i><b>11.6</b> Calculate dirichlet distributions of relative abundance</a></li>
<li class="chapter" data-level="11.7" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#boxplot-visualization-of-overall-relative-abundance-across-time-periods"><i class="fa fa-check"></i><b>11.7</b> Boxplot visualization of overall relative abundance across time periods</a></li>
<li class="chapter" data-level="11.8" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#species-relative-abundances-at-the-site-level"><i class="fa fa-check"></i><b>11.8</b> Species relative abundances at the site-level</a></li>
<li class="chapter" data-level="11.9" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#visualizing-differences-in-relative-abundance-over-time-at-the-site-level"><i class="fa fa-check"></i><b>11.9</b> Visualizing differences in relative abundance over time at the site level</a></li>
<li class="chapter" data-level="11.10" data-path="species-relative-abundances-over-time.html"><a href="species-relative-abundances-over-time.html#writing-results-to-file"><i class="fa fa-check"></i><b>11.10</b> Writing results to file</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><i class="fa fa-check"></i><b>12</b> Examining changes in relative abundance over time as a function of species habitat affiliation</a>
<ul>
<li class="chapter" data-level="12.1" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#load-necessary-libraries-6"><i class="fa fa-check"></i><b>12.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="12.2" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#load-data-on-species-relative-abundances"><i class="fa fa-check"></i><b>12.2</b> Load data on species relative abundances</a></li>
<li class="chapter" data-level="12.3" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#load-species-trait-data"><i class="fa fa-check"></i><b>12.3</b> Load species trait data</a></li>
<li class="chapter" data-level="12.4" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#analysis-to-test-for-significant-differences-in-relative-abundances-by-species-across-habitat-types"><i class="fa fa-check"></i><b>12.4</b> Analysis to test for significant differences in relative abundances by species across habitat types</a></li>
<li class="chapter" data-level="12.5" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#summary-of-relative-abundance-changes-by-species-as-a-function-of-habitat-affiliation"><i class="fa fa-check"></i><b>12.5</b> Summary of relative abundance changes by species as a function of habitat affiliation</a></li>
<li class="chapter" data-level="12.6" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#has-relative-abundance-increased-or-decreased-for-each-species-over-time"><i class="fa fa-check"></i><b>12.6</b> Has relative abundance increased or decreased for each species over time?</a></li>
<li class="chapter" data-level="12.7" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#box-plots-of-relative-abundance-by-species-trait-across-time-periods"><i class="fa fa-check"></i><b>12.7</b> Box plots of relative abundance by species trait across time periods</a></li>
<li class="chapter" data-level="12.8" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#are-there-significant-decreases-in-relative-abundance-by-time-periods-across-habitat-affiliations"><i class="fa fa-check"></i><b>12.8</b> Are there significant decreases in relative abundance by time periods across habitat affiliations?</a></li>
<li class="chapter" data-level="12.9" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#forest-birds"><i class="fa fa-check"></i><b>12.9</b> Forest birds</a></li>
<li class="chapter" data-level="12.10" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#grassland-birds"><i class="fa fa-check"></i><b>12.10</b> Grassland birds</a></li>
<li class="chapter" data-level="12.11" data-path="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html"><a href="examining-changes-in-relative-abundance-over-time-as-a-function-of-species-habitat-affiliation.html#generalist-birds"><i class="fa fa-check"></i><b>12.11</b> Generalist birds</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html"><i class="fa fa-check"></i><b>13</b> Species relative abundance as a function of environmental changes</a>
<ul>
<li class="chapter" data-level="13.1" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#load-necessary-libraries-7"><i class="fa fa-check"></i><b>13.1</b> Load necessary libraries</a></li>
<li class="chapter" data-level="13.2" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#load-processed-land-cover-rasters-2"><i class="fa fa-check"></i><b>13.2</b> Load processed land cover rasters</a></li>
<li class="chapter" data-level="13.3" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#load-modern-resurvey-locations"><i class="fa fa-check"></i><b>13.3</b> Load modern resurvey locations</a></li>
<li class="chapter" data-level="13.4" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#create-spatial-data-within-a-1000m-buffer-around-each-site"><i class="fa fa-check"></i><b>13.4</b> Create spatial data within a 1000m buffer around each site</a></li>
<li class="chapter" data-level="13.5" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#extract-land-cover-data-across-locations-from-the-1848-and-the-2018-rasters"><i class="fa fa-check"></i><b>13.5</b> Extract land cover data across locations from the 1848 and the 2018 rasters</a></li>
<li class="chapter" data-level="13.6" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#calculate-change-in-proportions-of-land-cover-between-time-periods"><i class="fa fa-check"></i><b>13.6</b> Calculate change in proportions of land cover between time periods</a></li>
<li class="chapter" data-level="13.7" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#calculate-change-in-climate-values-at-sampling-sites"><i class="fa fa-check"></i><b>13.7</b> Calculate change in climate values at sampling sites</a></li>
<li class="chapter" data-level="13.8" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#load-species-relative-abundance"><i class="fa fa-check"></i><b>13.8</b> Load species relative abundance</a></li>
<li class="chapter" data-level="13.9" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#load-species-trait-data-1"><i class="fa fa-check"></i><b>13.9</b> Load species trait data</a></li>
<li class="chapter" data-level="13.10" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#is-there-a-significant-association-between-change-in-relative-abundance-and-change-in-land-cover-across-time-periods"><i class="fa fa-check"></i><b>13.10</b> Is there a significant association between change in relative abundance and change in land cover across time periods?</a></li>
<li class="chapter" data-level="13.11" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#test-for-correlations-between-covariates"><i class="fa fa-check"></i><b>13.11</b> Test for correlations between covariates</a></li>
<li class="chapter" data-level="13.12" data-path="species-relative-abundance-as-a-function-of-environmental-changes.html"><a href="species-relative-abundance-as-a-function-of-environmental-changes.html#running-generalized-linear-mixed-effect-models-for-specific-habitat-affiliations"><i class="fa fa-check"></i><b>13.12</b> Running generalized linear mixed effect models for specific habitat affiliations</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Colonial-era landscape changes are concomitant with grassland bird species declines over the last century</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-and-validating-semi-spatial-gams-for-climate" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Section 3</span> Building and validating semi-spatial GAMs for climate<a href="building-and-validating-semi-spatial-gams-for-climate.html#building-and-validating-semi-spatial-gams-for-climate" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The overall aim here is to model historical climate variables — mean temperature, standard deviation in temperature, and total precipitation — as functions of geographical characteristics of the locations with which the data are associated.</p>
<p>We fit three candidate models of increasing complexity.
Then, the models are used to predict historical climate over the entire study area; we refer to these as semi-spatial climate models, as they include additional predictors over the coordinates of the locations alone.</p>
<p>The climate data extend into the modern period, allowing predictions from the candidate models to be compared against data from remote sensing, in order to select the best model formulation for each climate variable in each season.</p>
<div id="load-libraries-1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Load libraries<a href="building-and-validating-semi-spatial-gams-for-climate.html#load-libraries-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb12-1" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb12-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb12-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb12-3" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb12-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb12-4" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb12-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb12-5" tabindex="-1"></a><span class="fu">library</span>(mgcv) <span class="co"># for GAMs</span></span>
<span id="cb12-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb12-6" tabindex="-1"></a><span class="fu">library</span>(terra) <span class="co"># for spatial rasters</span></span></code></pre></div>
</div>
<div id="prepare-linked-climate-spatial-data-and-spatial-data-for-modelling" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Prepare linked climate-spatial data and spatial data for modelling<a href="building-and-validating-semi-spatial-gams-for-climate.html#prepare-linked-climate-spatial-data-and-spatial-data-for-modelling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We load the historical climate data with linked geographical covariates (hereon, climate data), and the spatial data raster stack.</p>
<p>We prepare the covariates for modelling: distance from the coast is converted from metres to kilometres, and a small amount of random noise is added to all values. This is necessary to allow for fitting as otherwise all predictor values are identical.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb13-1" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb13-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb13-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;results/climate/data_for_gam.csv&quot;</span>)</span>
<span id="cb13-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb13-3" tabindex="-1"></a><span class="co"># `stack` is the raster stack of geographical predictors, and not the climate</span></span>
<span id="cb13-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb13-4" tabindex="-1"></a><span class="co"># model predictions.</span></span>
<span id="cb13-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb13-5" tabindex="-1"></a>stack <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;results/climate/raster_gam_stack.tif&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-1" tabindex="-1"></a><span class="co"># prepare data for gam fitting</span></span>
<span id="cb14-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb14-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-3" tabindex="-1"></a>  data,</span>
<span id="cb14-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-5" tabindex="-1"></a>  <span class="co"># divide distance by 1000 for km</span></span>
<span id="cb14-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-6" tabindex="-1"></a>  <span class="at">coast =</span> coast <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb14-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-8" tabindex="-1"></a>  <span class="co"># add some error to all physical variables</span></span>
<span id="cb14-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-9" tabindex="-1"></a>  <span class="co"># hopefully prevents model issues</span></span>
<span id="cb14-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-10" tabindex="-1"></a>  <span class="at">coast =</span> coast <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(coast), <span class="fl">0.1</span>, <span class="at">sd =</span> <span class="fl">0.01</span>),</span>
<span id="cb14-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-11" tabindex="-1"></a>  <span class="at">elev =</span> elev <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(coast), <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.01</span>),</span>
<span id="cb14-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-12" tabindex="-1"></a>  <span class="at">lat =</span> lat <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(lat), <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.01</span>)</span>
<span id="cb14-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-13" tabindex="-1"></a>)</span>
<span id="cb14-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-14" tabindex="-1"></a></span>
<span id="cb14-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-15" tabindex="-1"></a><span class="co"># set distance to coast raster in km</span></span>
<span id="cb14-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb14-16" tabindex="-1"></a><span class="fu">values</span>(stack[[<span class="st">&quot;coast&quot;</span>]]) <span class="ot">&lt;-</span> <span class="fu">values</span>(stack[[<span class="st">&quot;coast&quot;</span>]]) <span class="sc">/</span> <span class="dv">1000</span></span></code></pre></div>
<p>We pivot the data to long format, and then nest the data by season and decade, gving us smaller datatsets for which models will be fit separately.</p>
<p>While there is no specific reason to believe that the relationship between climate and geographical predictors has changed over the past 150 years, splitting the data by decade may help adjust for long-term climate system effects within certain time-periods that could be drowned out by the overall effect of geographical predictors.</p>
<p>We subset the data for the decades between 1970 and 2010 for which reliable comparator spatial climate datasets are available from remote sensing.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-1" tabindex="-1"></a><span class="co"># Pivot to long format, remove unnecessary variables,</span></span>
<span id="cb15-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb15-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-3" tabindex="-1"></a>  data,</span>
<span id="cb15-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-4" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;ppt&quot;</span>, <span class="st">&quot;t_mean&quot;</span>, <span class="st">&quot;t_sd&quot;</span>),</span>
<span id="cb15-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-5" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&quot;climvar&quot;</span></span>
<span id="cb15-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-6" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-7" tabindex="-1"></a>data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(data, <span class="sc">!</span>month)</span>
<span id="cb15-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-8" tabindex="-1"></a></span>
<span id="cb15-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-9" tabindex="-1"></a><span class="co"># Select period 1970 -- 2010 where we also have satellite data</span></span>
<span id="cb15-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb15-10" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, <span class="fu">between</span>(year, <span class="dv">1970</span>, <span class="dv">2010</span>))</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb16-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">nest</span>(</span>
<span id="cb16-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb16-2" tabindex="-1"></a>  data,</span>
<span id="cb16-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb16-3" tabindex="-1"></a>  <span class="at">data =</span> <span class="sc">!</span><span class="fu">c</span>(climvar, season, year_bin)</span>
<span id="cb16-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb16-4" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="fit-candidate-spatial-climate-models" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Fit candidate spatial-climate models<a href="building-and-validating-semi-spatial-gams-for-climate.html#fit-candidate-spatial-climate-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We prepare three candidate spatial-climate models for each climate variable:</p>
<ul>
<li><p>A model where the variable is only a smooth function of elevation;</p></li>
<li><p>A model where the variable is a smooth function of elevation, and a linear function of distance from the coast and latitude; and</p></li>
<li><p>A model where the variable is a smooth function of elevation, and of the interaction between latitude and distance from the coast.</p></li>
</ul>
<p>We create combinations of each climate variable dataset (further split by decade and season) and each model formulation, and fit the variable to candidate predictors using generalised additive models (GAMs) from <a href="https://cran.r-project.org/package=mgcv">the <em>mgcv</em> package</a>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb17-1" tabindex="-1"></a><span class="co"># elevation with 3 knots</span></span>
<span id="cb17-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb17-2" tabindex="-1"></a>form_elev_model <span class="ot">&lt;-</span> value <span class="sc">~</span> <span class="fu">s</span>(elev, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb17-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb17-4" tabindex="-1"></a><span class="co"># elevation and coast</span></span>
<span id="cb17-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb17-5" tabindex="-1"></a>form_elev_coast <span class="ot">&lt;-</span> value <span class="sc">~</span> <span class="fu">s</span>(elev, <span class="at">k =</span> <span class="dv">3</span>) <span class="sc">+</span> coast <span class="sc">+</span> lat</span>
<span id="cb17-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb17-7" tabindex="-1"></a><span class="co"># elevation and coast with lat</span></span>
<span id="cb17-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb17-8" tabindex="-1"></a>form_elev_colat <span class="ot">&lt;-</span> value <span class="sc">~</span> <span class="fu">s</span>(elev, <span class="at">k =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">s</span>(coast, lat, <span class="at">k =</span> <span class="dv">5</span>)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb18-1" tabindex="-1"></a><span class="co"># make combinations</span></span>
<span id="cb18-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb18-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">crossing</span>(</span>
<span id="cb18-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb18-3" tabindex="-1"></a>  data,</span>
<span id="cb18-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb18-4" tabindex="-1"></a>  <span class="at">forms =</span> <span class="fu">c</span>(form_elev_model, form_elev_coast, form_elev_colat)</span>
<span id="cb18-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb18-5" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-1" tabindex="-1"></a><span class="co"># fit models</span></span>
<span id="cb19-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb19-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-3" tabindex="-1"></a>  data,</span>
<span id="cb19-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-4" tabindex="-1"></a>  <span class="at">mod =</span> <span class="fu">map2</span>(data, forms, <span class="cf">function</span>(df, form) {</span>
<span id="cb19-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-5" tabindex="-1"></a>    <span class="fu">gam</span>(</span>
<span id="cb19-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-6" tabindex="-1"></a>      <span class="at">formula =</span> form,</span>
<span id="cb19-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-7" tabindex="-1"></a>      <span class="at">data =</span> df</span>
<span id="cb19-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-8" tabindex="-1"></a>    )</span>
<span id="cb19-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-9" tabindex="-1"></a>  })</span>
<span id="cb19-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb19-10" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb20-1" tabindex="-1"></a><span class="co"># Save the fitted model data as an Rdata object</span></span>
<span id="cb20-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb20-2" tabindex="-1"></a><span class="fu">save</span>(data, <span class="at">file =</span> <span class="st">&quot;results/climate/model_gam_climate.Rds&quot;</span>)</span></code></pre></div>
</div>
<div id="model-predictions-for-modern-climate" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Model predictions for modern climate<a href="building-and-validating-semi-spatial-gams-for-climate.html#model-predictions-for-modern-climate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We use the fitted models to predict climatic variables over the remainder of the study area.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-1" tabindex="-1"></a><span class="co"># ensure that NAs are removed from the stack object before running the model</span></span>
<span id="cb21-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-2" tabindex="-1"></a><span class="co"># projections</span></span>
<span id="cb21-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-3" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">global</span>(stack, <span class="at">fun =</span> <span class="st">&quot;isNA&quot;</span>)</span>
<span id="cb21-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-5" tabindex="-1"></a><span class="co"># this tells us that two raster layers within the stack object have NA values</span></span>
<span id="cb21-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-6" tabindex="-1"></a></span>
<span id="cb21-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-7" tabindex="-1"></a>stack<span class="sc">$</span>coast[<span class="fu">is.na</span>(stack<span class="sc">$</span>coast)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-8" tabindex="-1"></a>stack<span class="sc">$</span>elev[stack<span class="sc">$</span>elev <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb21-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-9" tabindex="-1"></a>stack<span class="sc">$</span>elev[<span class="fu">is.na</span>(stack<span class="sc">$</span>elev)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-10" tabindex="-1"></a>stack<span class="sc">$</span>elev <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(stack<span class="sc">$</span>elev)</span>
<span id="cb21-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-12" tabindex="-1"></a><span class="co"># save model predictions</span></span>
<span id="cb21-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-13" tabindex="-1"></a>model_pred <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb21-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-14" tabindex="-1"></a>  data<span class="sc">$</span>mod, <span class="cf">function</span>(g) {</span>
<span id="cb21-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-15" tabindex="-1"></a>    <span class="fu">predict</span>(stack, g, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="co"># order matters here</span></span>
<span id="cb21-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-16" tabindex="-1"></a>  }</span>
<span id="cb21-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-17" tabindex="-1"></a>)</span>
<span id="cb21-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-18" tabindex="-1"></a></span>
<span id="cb21-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-19" tabindex="-1"></a><span class="co"># `Reduce()` with function `c()` combines model predictions into a</span></span>
<span id="cb21-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-20" tabindex="-1"></a><span class="co"># single raster stack, which is then saved</span></span>
<span id="cb21-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-21" tabindex="-1"></a>model_pred <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(model_pred, <span class="at">f =</span> c)</span>
<span id="cb21-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb21-22" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(model_pred, <span class="st">&quot;results/climate/data_gam_pred.tif&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb22-1" tabindex="-1"></a><span class="co"># Read in the saved model predictions</span></span>
<span id="cb22-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb22-2" tabindex="-1"></a><span class="co"># this allows us to start at this stage without needing to run</span></span>
<span id="cb22-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb22-3" tabindex="-1"></a><span class="co"># previous steps</span></span>
<span id="cb22-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb22-4" tabindex="-1"></a>model_pred <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;results/climate/data_gam_pred.tif&quot;</span>)</span></code></pre></div>
</div>
<div id="average-predictions-over-1970-to-2010" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Average predictions over 1970 to 2010<a href="building-and-validating-semi-spatial-gams-for-climate.html#average-predictions-over-1970-to-2010" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We combine the model predictions with the appropriate identifier variables (decade, season, climate variable, and model formulation) in the nested climate data dataframe, and get the average predicted values for each variable in each season.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-1" tabindex="-1"></a><span class="co"># assign as list column</span></span>
<span id="cb23-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb23-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-3" tabindex="-1"></a>  data,</span>
<span id="cb23-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-4" tabindex="-1"></a>  <span class="at">pred =</span> <span class="fu">as.list</span>(model_pred)</span>
<span id="cb23-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-5" tabindex="-1"></a>)</span>
<span id="cb23-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-6" tabindex="-1"></a></span>
<span id="cb23-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-7" tabindex="-1"></a><span class="co"># Summarise rasters using a reduce over the list</span></span>
<span id="cb23-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-8" tabindex="-1"></a><span class="co"># basically gets the average over 1970 -- 2010</span></span>
<span id="cb23-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-9" tabindex="-1"></a>data_pred <span class="ot">&lt;-</span> <span class="fu">ungroup</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-10" tabindex="-1"></a>  <span class="fu">group_by</span>(season, climvar, forms) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-11" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb23-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-12" tabindex="-1"></a>    <span class="at">mean_pred =</span> <span class="fu">list</span>(<span class="fu">Reduce</span>(pred, <span class="at">f =</span> mean))</span>
<span id="cb23-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-13" tabindex="-1"></a>  )</span>
<span id="cb23-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-14" tabindex="-1"></a></span>
<span id="cb23-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-15" tabindex="-1"></a><span class="co"># make raster stack</span></span>
<span id="cb23-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-16" tabindex="-1"></a>gam_pred_avg <span class="ot">&lt;-</span> data_pred<span class="sc">$</span>mean_pred</span>
<span id="cb23-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-17" tabindex="-1"></a>gam_pred_avg <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="at">f =</span> c, gam_pred_avg)</span>
<span id="cb23-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-18" tabindex="-1"></a></span>
<span id="cb23-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-19" tabindex="-1"></a><span class="co"># save averaged predictions</span></span>
<span id="cb23-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-20" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb23-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-21" tabindex="-1"></a>  gam_pred_avg,</span>
<span id="cb23-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-22" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;results/climate/gam_pred_valid_avg.tif&quot;</span></span>
<span id="cb23-23"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb23-23" tabindex="-1"></a>)</span></code></pre></div>
<p>We save the dataframe of season, climate variable, and model formula for future reference.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-1" tabindex="-1"></a><span class="co"># load saved pred</span></span>
<span id="cb24-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-2" tabindex="-1"></a>gam_pred_avg <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;results/climate/gam_pred_valid_avg.tif&quot;</span>)</span>
<span id="cb24-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-4" tabindex="-1"></a><span class="co"># write data for linking</span></span>
<span id="cb24-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-5" tabindex="-1"></a>data_pred <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-6" tabindex="-1"></a>  <span class="co"># ungroup the data</span></span>
<span id="cb24-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-7" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-8" tabindex="-1"></a>  <span class="co"># get unique season, variable, and model formula</span></span>
<span id="cb24-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-9" tabindex="-1"></a>  <span class="fu">distinct</span>(season, climvar, forms) <span class="sc">|&gt;</span></span>
<span id="cb24-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-10" tabindex="-1"></a>  <span class="co"># then get the model formula as a character</span></span>
<span id="cb24-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-12" tabindex="-1"></a>    <span class="at">forms =</span> <span class="fu">map_chr</span>(forms, <span class="cf">function</span>(l) {</span>
<span id="cb24-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-13" tabindex="-1"></a>      <span class="fu">str_flatten</span>(<span class="fu">as.character</span>(l)[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>)])</span>
<span id="cb24-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-14" tabindex="-1"></a>    })</span>
<span id="cb24-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-15" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb24-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-16" tabindex="-1"></a>  <span class="co"># save to file</span></span>
<span id="cb24-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-17" tabindex="-1"></a>  <span class="fu">write_csv</span>(</span>
<span id="cb24-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-18" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;results/climate/gam_model_formulas.csv&quot;</span></span>
<span id="cb24-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb24-19" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="get-bioclim-data" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Get BIOCLIM data<a href="building-and-validating-semi-spatial-gams-for-climate.html#get-bioclim-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we acquire remotely sensed cliamte variables for the study area, which will serve as a comparator for the values generated from fitted model predictions, and will help to pick the most appropriate model formulation to reconstruct historical climate for which remotely sensed data are not available.</p>
<p>First, we obtained bio-climatic data from CHELSA. We do not upload the rasters to GitHub as they are very large in size and these can be downloaded from this link: <a href="https://envicloud.wsl.ch/#/?prefix=chelsa%2Fchelsa_V1" class="uri">https://envicloud.wsl.ch/#/?prefix=chelsa%2Fchelsa_V1</a></p>
</div>
<div id="temperature-data" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Temperature data<a href="building-and-validating-semi-spatial-gams-for-climate.html#temperature-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We process monthly minimum and maximum CHELSA temperature data to get the mean monthly temperature in the dry and wet season as previously defined.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-1" tabindex="-1"></a><span class="co"># Define the patterns for data to search local data files</span></span>
<span id="cb25-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-2" tabindex="-1"></a>patterns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;tmin&quot;</span>, <span class="st">&quot;tmax&quot;</span>)</span>
<span id="cb25-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-4" tabindex="-1"></a><span class="co"># List the filepaths matching the pattern in local data (relative to the proj.)</span></span>
<span id="cb25-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-5" tabindex="-1"></a>tkAvg <span class="ot">&lt;-</span> <span class="fu">map</span>(patterns, <span class="cf">function</span>(pattern) {</span>
<span id="cb25-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-6" tabindex="-1"></a>  <span class="co"># list the paths</span></span>
<span id="cb25-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-7" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb25-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-8" tabindex="-1"></a>    <span class="at">path =</span> <span class="st">&quot;data/climate/chelsa&quot;</span>,</span>
<span id="cb25-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-9" tabindex="-1"></a>    <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-10" tabindex="-1"></a>    <span class="at">recursive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-11" tabindex="-1"></a>    <span class="at">pattern =</span> pattern</span>
<span id="cb25-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-12" tabindex="-1"></a>  )</span>
<span id="cb25-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-13" tabindex="-1"></a>})</span>
<span id="cb25-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-14" tabindex="-1"></a></span>
<span id="cb25-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-15" tabindex="-1"></a><span class="co"># Read found rasters and crop them to the extent of other rasters representing</span></span>
<span id="cb25-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-16" tabindex="-1"></a><span class="co"># the study area; this is the object `stack`</span></span>
<span id="cb25-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-17" tabindex="-1"></a>tkAvg <span class="ot">&lt;-</span> <span class="fu">map</span>(tkAvg, <span class="cf">function</span>(paths) {</span>
<span id="cb25-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-18" tabindex="-1"></a>  <span class="co"># going over the file paths, read them in as rasters, convert CRS and crop</span></span>
<span id="cb25-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-19" tabindex="-1"></a>  tempData <span class="ot">&lt;-</span> <span class="fu">map</span>(paths, <span class="cf">function</span>(path) {</span>
<span id="cb25-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-20" tabindex="-1"></a>    a <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(path)</span>
<span id="cb25-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-21" tabindex="-1"></a>    a <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(a, terra<span class="sc">::</span><span class="fu">ext</span>(stack))</span>
<span id="cb25-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-22" tabindex="-1"></a>    a</span>
<span id="cb25-23"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-23" tabindex="-1"></a>  })</span>
<span id="cb25-24"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-24" tabindex="-1"></a></span>
<span id="cb25-25"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-25" tabindex="-1"></a>  <span class="co"># The data are in a native format that needs to be converted before</span></span>
<span id="cb25-26"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-26" tabindex="-1"></a>  <span class="co"># processing.</span></span>
<span id="cb25-27"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-27" tabindex="-1"></a>  <span class="co"># Convert each to Kelvin, first dividing by 10 to get celsius</span></span>
<span id="cb25-28"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-28" tabindex="-1"></a>  tempData <span class="ot">&lt;-</span> <span class="fu">map</span>(tempData, <span class="cf">function</span>(tmpRaster) {</span>
<span id="cb25-29"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-29" tabindex="-1"></a>    tmpRaster <span class="ot">&lt;-</span> (tmpRaster <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fl">273.15</span></span>
<span id="cb25-30"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-30" tabindex="-1"></a>    tmpRaster</span>
<span id="cb25-31"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-31" tabindex="-1"></a>  })</span>
<span id="cb25-32"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-32" tabindex="-1"></a>})</span>
<span id="cb25-33"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-33" tabindex="-1"></a></span>
<span id="cb25-34"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-34" tabindex="-1"></a><span class="co"># Iteratively get the mean temperature for each month, and assign</span></span>
<span id="cb25-35"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-35" tabindex="-1"></a><span class="co"># names to the resulting raster stacks</span></span>
<span id="cb25-36"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-36" tabindex="-1"></a><span class="fu">names</span>(tkAvg) <span class="ot">&lt;-</span> patterns</span>
<span id="cb25-37"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-37" tabindex="-1"></a></span>
<span id="cb25-38"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-38" tabindex="-1"></a><span class="co"># go over the tmin and tmax and get the average monthly temp</span></span>
<span id="cb25-39"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-39" tabindex="-1"></a>tkAvg <span class="ot">&lt;-</span> <span class="fu">map2</span>(tkAvg[[<span class="st">&quot;tmin&quot;</span>]], tkAvg[[<span class="st">&quot;tmax&quot;</span>]], <span class="cf">function</span>(tmin, tmax) {</span>
<span id="cb25-40"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-40" tabindex="-1"></a>  <span class="co"># return the mean of the corresponding tmin and tmax</span></span>
<span id="cb25-41"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-41" tabindex="-1"></a>  <span class="co"># still in Kelvin</span></span>
<span id="cb25-42"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-42" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mean</span>(<span class="fu">c</span>(tmin, tmax))</span>
<span id="cb25-43"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-43" tabindex="-1"></a>})</span>
<span id="cb25-44"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-44" tabindex="-1"></a></span>
<span id="cb25-45"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-45" tabindex="-1"></a><span class="co"># Error if the there are fewer than 12 output layers</span></span>
<span id="cb25-46"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-46" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(</span>
<span id="cb25-47"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-47" tabindex="-1"></a>  <span class="fu">length</span>(tkAvg) <span class="sc">==</span> <span class="dv">12</span>,</span>
<span id="cb25-48"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-48" tabindex="-1"></a>  <span class="at">msg =</span> <span class="st">&quot;temp raster list has fewer than 12 months&quot;</span></span>
<span id="cb25-49"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-49" tabindex="-1"></a>)</span>
<span id="cb25-50"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-50" tabindex="-1"></a></span>
<span id="cb25-51"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-51" tabindex="-1"></a><span class="co"># Assign names to identify months</span></span>
<span id="cb25-52"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-52" tabindex="-1"></a><span class="fu">names</span>(tkAvg) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;month_%i&quot;</span>, <span class="fu">seq</span>(<span class="dv">12</span>))</span>
<span id="cb25-53"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-53" tabindex="-1"></a></span>
<span id="cb25-54"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-54" tabindex="-1"></a><span class="co"># Separate data for the rainy and dry seasons to get the</span></span>
<span id="cb25-55"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-55" tabindex="-1"></a><span class="co"># rainy and dry season mean monthyl temperature</span></span>
<span id="cb25-56"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-56" tabindex="-1"></a>temp_rainy <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(tkAvg[<span class="fu">seq</span>(<span class="dv">6</span>, <span class="dv">11</span>)], <span class="at">f =</span> <span class="st">`</span><span class="at">c</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-57"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-57" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mean</span>()</span>
<span id="cb25-58"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-58" tabindex="-1"></a>temp_dry <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(tkAvg[<span class="fu">c</span>(<span class="dv">12</span>, <span class="fu">seq</span>(<span class="dv">5</span>))], <span class="at">f =</span> <span class="st">`</span><span class="at">c</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-59"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-59" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mean</span>()</span>
<span id="cb25-60"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-60" tabindex="-1"></a></span>
<span id="cb25-61"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-61" tabindex="-1"></a><span class="co"># Convert values back to celsius</span></span>
<span id="cb25-62"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-62" tabindex="-1"></a>chelsa_t_mean <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_rainy, temp_dry) <span class="sc">-</span> <span class="fl">273.15</span></span>
<span id="cb25-63"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-63" tabindex="-1"></a><span class="fu">names</span>(chelsa_t_mean) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;chelsa_temp_rainy_6_11&quot;</span>, <span class="st">&quot;chelsa_temp_dry_12_5&quot;</span>)</span>
<span id="cb25-64"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-64" tabindex="-1"></a></span>
<span id="cb25-65"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-65" tabindex="-1"></a><span class="co"># Save stack</span></span>
<span id="cb25-66"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-66" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb25-67"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-67" tabindex="-1"></a>  chelsa_t_mean,</span>
<span id="cb25-68"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-68" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;results/climate/chelsa_temp_stack.tif&quot;</span>,</span>
<span id="cb25-69"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-69" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb25-70"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb25-70" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="precipitation-data" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Precipitation data<a href="building-and-validating-semi-spatial-gams-for-climate.html#precipitation-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We process total monthly precipitation data from CHELSA to get the mean monthly temperature in the dry and wet seasons in millimetres.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-1" tabindex="-1"></a><span class="co"># List precipitation rasters stored locally (relative to this project)</span></span>
<span id="cb26-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-2" tabindex="-1"></a>ppt <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb26-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-3" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">&quot;data/climate/chelsa&quot;</span>,</span>
<span id="cb26-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-4" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-5" tabindex="-1"></a>  <span class="at">recursive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-6" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">&quot;prec&quot;</span></span>
<span id="cb26-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-7" tabindex="-1"></a>)</span>
<span id="cb26-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-9" tabindex="-1"></a><span class="co"># Read each as rasters and crop by extent of study area</span></span>
<span id="cb26-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-10" tabindex="-1"></a>ppt <span class="ot">&lt;-</span> <span class="fu">map</span>(ppt, <span class="cf">function</span>(path) {</span>
<span id="cb26-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-11" tabindex="-1"></a>  a <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(path)</span>
<span id="cb26-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-12" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(a, terra<span class="sc">::</span><span class="fu">ext</span>(stack))</span>
<span id="cb26-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-13" tabindex="-1"></a>})</span>
<span id="cb26-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-14" tabindex="-1"></a></span>
<span id="cb26-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-15" tabindex="-1"></a><span class="co"># Separate rainy and dry season and get the mean total monthly precipitation</span></span>
<span id="cb26-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-16" tabindex="-1"></a>ppt_rainy <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(ppt[<span class="fu">seq</span>(<span class="dv">6</span>, <span class="dv">11</span>)], <span class="at">f =</span> <span class="st">`</span><span class="at">c</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-17" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mean</span>()</span>
<span id="cb26-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-18" tabindex="-1"></a>ppt_dry <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(ppt[<span class="fu">c</span>(<span class="dv">12</span>, <span class="fu">seq</span>(<span class="dv">5</span>))], <span class="at">f =</span> <span class="st">`</span><span class="at">c</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-19" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mean</span>()</span>
<span id="cb26-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-20" tabindex="-1"></a></span>
<span id="cb26-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-21" tabindex="-1"></a><span class="co"># Make and save stack</span></span>
<span id="cb26-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-22" tabindex="-1"></a>chelsa_ppt_sum <span class="ot">&lt;-</span> <span class="fu">c</span>(ppt_rainy, ppt_dry)</span>
<span id="cb26-23"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-23" tabindex="-1"></a><span class="fu">names</span>(chelsa_ppt_sum) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;chelsa_ppt_rainy_6_11&quot;</span>, <span class="st">&quot;chelsa_ppt_dry_12_5&quot;</span>)</span>
<span id="cb26-24"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-24" tabindex="-1"></a></span>
<span id="cb26-25"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-25" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb26-26"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-26" tabindex="-1"></a>  chelsa_ppt_sum,</span>
<span id="cb26-27"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-27" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;results/climate/chelsa_ppt_stack.tif&quot;</span>,</span>
<span id="cb26-28"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-28" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb26-29"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb26-29" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="compare-spatial-climate-model-predictions-against-bioclim-data" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> Compare spatial-climate model predictions against BIOCLIM data<a href="building-and-validating-semi-spatial-gams-for-climate.html#compare-spatial-climate-model-predictions-against-bioclim-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="sample-locations" class="section level2 hasAnchor" number="3.10">
<h2><span class="header-section-number">3.10</span> Sample locations<a href="building-and-validating-semi-spatial-gams-for-climate.html#sample-locations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First we draw 10,000 randomly selected coordinates from the extent of the study area, and use these to compare the model predictions against CHELSA-derived data.
We will further stratify these into 10 arbitrary groups at a later stage.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-1" tabindex="-1"></a><span class="co"># get coordinates from terra</span></span>
<span id="cb27-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-2" tabindex="-1"></a>coords <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">xyFromCell</span>(</span>
<span id="cb27-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-3" tabindex="-1"></a>  stack,</span>
<span id="cb27-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-4" tabindex="-1"></a>  <span class="at">cell =</span> <span class="fu">seq</span>(<span class="fu">length</span>(<span class="fu">values</span>(stack[[<span class="dv">1</span>]])))</span>
<span id="cb27-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-5" tabindex="-1"></a>)</span>
<span id="cb27-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-7" tabindex="-1"></a><span class="co"># Sample 1000 locations from the raster data coordinates</span></span>
<span id="cb27-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-8" tabindex="-1"></a><span class="co"># Use `withr::with_local_seed()` to preserve which coordinates are selected</span></span>
<span id="cb27-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-9" tabindex="-1"></a><span class="co"># in each analysis run</span></span>
<span id="cb27-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-10" tabindex="-1"></a>coords <span class="ot">&lt;-</span> withr<span class="sc">::</span><span class="fu">with_seed</span>(</span>
<span id="cb27-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-11" tabindex="-1"></a>  <span class="dv">1</span>,</span>
<span id="cb27-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-12" tabindex="-1"></a>  coords[<span class="fu">sample</span>(<span class="fl">1e4</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>), ]</span>
<span id="cb27-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-13" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb27-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-14" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb27-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-15" tabindex="-1"></a></span>
<span id="cb27-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-16" tabindex="-1"></a><span class="co"># Extract geographical predictors and CHELSA data at locations</span></span>
<span id="cb27-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-17" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: recall that `stack` is the raster stack of geographical predictors</span></span>
<span id="cb27-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-18" tabindex="-1"></a>sample_locations <span class="ot">&lt;-</span></span>
<span id="cb27-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-19" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-20" tabindex="-1"></a>    coords,</span>
<span id="cb27-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-21" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">extract</span>(stack, coords)</span>
<span id="cb27-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-22" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-23"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-23" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-24"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-24" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">extract</span>(chelsa_ppt_sum, coords)</span>
<span id="cb27-25"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-25" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-26"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-26" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-27"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-27" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">extract</span>(chelsa_t_mean, coords)</span>
<span id="cb27-28"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb27-28" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb28-1" tabindex="-1"></a><span class="co"># save data</span></span>
<span id="cb28-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb28-2" tabindex="-1"></a><span class="fu">write_csv</span>(</span>
<span id="cb28-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb28-3" tabindex="-1"></a>  sample_locations,</span>
<span id="cb28-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb28-4" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;results/climate/data_sample_coords_gam_validation.csv&quot;</span></span>
<span id="cb28-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb28-5" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="link-bioclim-data-and-model-predictions" class="section level2 hasAnchor" number="3.11">
<h2><span class="header-section-number">3.11</span> Link BIOCLIM data and model predictions<a href="building-and-validating-semi-spatial-gams-for-climate.html#link-bioclim-data-and-model-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next we link the remote-sensing-derived BIOCLIM data at the sampled locations with the predicted values from our spatial-climate GAMs.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb29-1" tabindex="-1"></a><span class="co"># Read in the saved data; this allows continuing from this point without</span></span>
<span id="cb29-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb29-2" tabindex="-1"></a><span class="co"># re-running the previous code</span></span>
<span id="cb29-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb29-3" tabindex="-1"></a>sample_locations <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb29-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb29-4" tabindex="-1"></a>  <span class="st">&quot;results/climate/data_sample_coords_gam_validation.csv&quot;</span></span>
<span id="cb29-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb29-5" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-1" tabindex="-1"></a><span class="co"># Pivot the data to long format, retaining coordinates, ID, and geographical</span></span>
<span id="cb30-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-2" tabindex="-1"></a><span class="co"># predictors as identifying variables</span></span>
<span id="cb30-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-3" tabindex="-1"></a>sample_locations <span class="ot">&lt;-</span></span>
<span id="cb30-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-4" tabindex="-1"></a>  sample_locations <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb30-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-6" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">!</span><span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;ID&quot;</span>, <span class="st">&quot;coast&quot;</span>, <span class="st">&quot;elev&quot;</span>, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb30-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-7" tabindex="-1"></a>  )</span>
<span id="cb30-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-8" tabindex="-1"></a></span>
<span id="cb30-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-9" tabindex="-1"></a><span class="co"># Assign the season and identify the variable from the variable name</span></span>
<span id="cb30-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-10" tabindex="-1"></a>sample_locations <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb30-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-11" tabindex="-1"></a>  sample_locations,</span>
<span id="cb30-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-12" tabindex="-1"></a>  <span class="at">season =</span> <span class="fu">str_extract</span>(</span>
<span id="cb30-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-13" tabindex="-1"></a>    name,</span>
<span id="cb30-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-14" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">&quot;dry|rainy&quot;</span></span>
<span id="cb30-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-15" tabindex="-1"></a>  ),</span>
<span id="cb30-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-16" tabindex="-1"></a>  <span class="at">climvar =</span> <span class="fu">str_extract</span>(</span>
<span id="cb30-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-17" tabindex="-1"></a>    name,</span>
<span id="cb30-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-18" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="st">&quot;temp|ppt&quot;</span></span>
<span id="cb30-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-19" tabindex="-1"></a>  ),</span>
<span id="cb30-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-20" tabindex="-1"></a>  <span class="at">climvar =</span> <span class="fu">if_else</span>(</span>
<span id="cb30-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-21" tabindex="-1"></a>    climvar <span class="sc">==</span> <span class="st">&quot;temp&quot;</span>, <span class="st">&quot;t_mean&quot;</span>, <span class="st">&quot;ppt&quot;</span></span>
<span id="cb30-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-22" tabindex="-1"></a>  )</span>
<span id="cb30-23"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb30-23" tabindex="-1"></a>)</span></code></pre></div>
<p>We link the spatial-climate models’ predictions. Recall that there are three candidate models for each variable, in each season, and the aim is to select a model formulation for the remaining historical data based on minimising deviation from the BIOCLIM data.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-1" tabindex="-1"></a><span class="co"># Filter the climate-model predictions to remove the SD of temperature</span></span>
<span id="cb31-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-2" tabindex="-1"></a>data_pred <span class="ot">&lt;-</span> <span class="fu">filter</span>(</span>
<span id="cb31-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-3" tabindex="-1"></a>  data_pred,</span>
<span id="cb31-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-4" tabindex="-1"></a>  climvar <span class="sc">!=</span> <span class="st">&quot;t_sd&quot;</span></span>
<span id="cb31-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-5" tabindex="-1"></a>)</span>
<span id="cb31-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-7" tabindex="-1"></a><span class="co"># Nest model predictions by season and variable</span></span>
<span id="cb31-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-8" tabindex="-1"></a>sample_locations <span class="ot">&lt;-</span> <span class="fu">nest</span>(</span>
<span id="cb31-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-9" tabindex="-1"></a>  sample_locations,</span>
<span id="cb31-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-10" tabindex="-1"></a>  <span class="at">chelsa =</span> <span class="sc">!</span><span class="fu">c</span>(<span class="st">&quot;season&quot;</span>, <span class="st">&quot;climvar&quot;</span>)</span>
<span id="cb31-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-11" tabindex="-1"></a>)</span>
<span id="cb31-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-12" tabindex="-1"></a></span>
<span id="cb31-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-13" tabindex="-1"></a><span class="co"># Link predictions for sampled locations with CHELSA data rasters and</span></span>
<span id="cb31-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-14" tabindex="-1"></a><span class="co"># geographical predictors</span></span>
<span id="cb31-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-15" tabindex="-1"></a>data_pred <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb31-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-16" tabindex="-1"></a>  data_pred,</span>
<span id="cb31-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-17" tabindex="-1"></a>  sample_locations</span>
<span id="cb31-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb31-18" tabindex="-1"></a>)</span></code></pre></div>
<p>Since the model prediction rasters are stored as-is, we need to extract the values at the coordinates from those rasters.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-1" tabindex="-1"></a><span class="co"># For each climate variable, extract the predicted values at the sampled</span></span>
<span id="cb32-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-2" tabindex="-1"></a><span class="co"># locations</span></span>
<span id="cb32-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-3" tabindex="-1"></a>data_pred <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb32-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-4" tabindex="-1"></a>  data_pred,</span>
<span id="cb32-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-5" tabindex="-1"></a>  <span class="at">chelsa =</span> <span class="fu">map2</span>(chelsa, mean_pred, <span class="cf">function</span>(ch, pr) {</span>
<span id="cb32-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-6" tabindex="-1"></a>    ch <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-7" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb32-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-8" tabindex="-1"></a>        <span class="at">bioclim_val =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb32-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-9" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb32-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-10" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb32-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-11" tabindex="-1"></a>        <span class="at">pred_val =</span> terra<span class="sc">::</span><span class="fu">extract</span>(pr, ch[, <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)])</span>
<span id="cb32-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-12" tabindex="-1"></a>        <span class="co"># the naming doesn&#39;t quite work</span></span>
<span id="cb32-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-13" tabindex="-1"></a>      )</span>
<span id="cb32-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-14" tabindex="-1"></a>  })</span>
<span id="cb32-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-15" tabindex="-1"></a>)</span>
<span id="cb32-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-16" tabindex="-1"></a></span>
<span id="cb32-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-17" tabindex="-1"></a><span class="co"># Make a copy for further operations</span></span>
<span id="cb32-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-18" tabindex="-1"></a>data_gam_validate <span class="ot">&lt;-</span> data_pred <span class="sc">|&gt;</span></span>
<span id="cb32-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-19" tabindex="-1"></a>  <span class="fu">select</span>(season, climvar, forms, chelsa)</span>
<span id="cb32-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-20" tabindex="-1"></a></span>
<span id="cb32-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-21" tabindex="-1"></a><span class="co"># Unnest data</span></span>
<span id="cb32-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-22" tabindex="-1"></a>data_gam_validate <span class="ot">&lt;-</span> <span class="fu">unnest</span>(</span>
<span id="cb32-23"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-23" tabindex="-1"></a>  data_gam_validate,</span>
<span id="cb32-24"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-24" tabindex="-1"></a>  <span class="at">cols =</span> chelsa</span>
<span id="cb32-25"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-25" tabindex="-1"></a>)</span>
<span id="cb32-26"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-26" tabindex="-1"></a></span>
<span id="cb32-27"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-27" tabindex="-1"></a><span class="co"># Convert model formula from formula to characters</span></span>
<span id="cb32-28"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-28" tabindex="-1"></a>data_gam_validate <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb32-29"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-29" tabindex="-1"></a>  data_gam_validate,</span>
<span id="cb32-30"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-30" tabindex="-1"></a>  <span class="at">forms =</span> <span class="fu">as.character</span>(forms)</span>
<span id="cb32-31"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-31" tabindex="-1"></a>)</span>
<span id="cb32-32"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-32" tabindex="-1"></a></span>
<span id="cb32-33"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-33" tabindex="-1"></a><span class="co"># Extract the predicted values</span></span>
<span id="cb32-34"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-34" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: check why this is being done again</span></span>
<span id="cb32-35"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-35" tabindex="-1"></a>data_gam_validate <span class="ot">&lt;-</span> data_gam_validate <span class="sc">|&gt;</span></span>
<span id="cb32-36"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-36" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-37"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-37" tabindex="-1"></a>    <span class="at">pred_val =</span> pred_val<span class="sc">$</span>lyr1</span>
<span id="cb32-38"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-38" tabindex="-1"></a>  )</span>
<span id="cb32-39"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-39" tabindex="-1"></a></span>
<span id="cb32-40"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-40" tabindex="-1"></a><span class="co"># Drop some variables and save data</span></span>
<span id="cb32-41"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-41" tabindex="-1"></a><span class="fu">write_csv</span>(</span>
<span id="cb32-42"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-42" tabindex="-1"></a>  data_gam_validate,</span>
<span id="cb32-43"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-43" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;results/climate/data_gam_validate_compare.csv&quot;</span></span>
<span id="cb32-44"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb32-44" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="error-between-model-prediction-and-chelsa-data" class="section level2 hasAnchor" number="3.12">
<h2><span class="header-section-number">3.12</span> Error between model prediction and CHELSA data<a href="building-and-validating-semi-spatial-gams-for-climate.html#error-between-model-prediction-and-chelsa-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We use mean absolute error (MAE) as a measure of how much the model predictions deviate from the CHELSA data. In order to calculate the mean, we group the data into ten arbitrary groups of 1,000 samples each.</p>
<p>We calculate MAE as the mean of the absolute differences between the CHELSA data and the model predicted data, and save the data to a local file.
MAE is calculated for each climate variable, model formulation, and season separately (in addition to the sample group, which is arbitrary).</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-1" tabindex="-1"></a><span class="co"># Group samples into 10 chunks of 1000 coordinates each</span></span>
<span id="cb33-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-2" tabindex="-1"></a>data_gam_validate <span class="ot">&lt;-</span> <span class="fu">group_by</span>(</span>
<span id="cb33-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-3" tabindex="-1"></a>  data_gam_validate,</span>
<span id="cb33-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-4" tabindex="-1"></a>  season, climvar, forms</span>
<span id="cb33-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-5" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb33-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-7" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">10</span>), <span class="at">each =</span> <span class="fl">1e3</span>L)</span>
<span id="cb33-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-8" tabindex="-1"></a>  )</span>
<span id="cb33-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-9" tabindex="-1"></a></span>
<span id="cb33-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-10" tabindex="-1"></a><span class="co"># Grouping by season, climate variable, and model formula, calculate MAE</span></span>
<span id="cb33-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-11" tabindex="-1"></a>data_mae <span class="ot">&lt;-</span></span>
<span id="cb33-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-12" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb33-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-13" tabindex="-1"></a>    data_gam_validate,</span>
<span id="cb33-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-14" tabindex="-1"></a>    season, climvar, forms, group</span>
<span id="cb33-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-15" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-16" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-17" tabindex="-1"></a>    <span class="at">mae =</span> <span class="fu">mean</span>(</span>
<span id="cb33-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-18" tabindex="-1"></a>      <span class="fu">abs</span>(</span>
<span id="cb33-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-19" tabindex="-1"></a>        bioclim_val <span class="sc">-</span> pred_val</span>
<span id="cb33-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-20" tabindex="-1"></a>      ),</span>
<span id="cb33-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-21" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb33-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-22" tabindex="-1"></a>    )</span>
<span id="cb33-23"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-23" tabindex="-1"></a>  )</span>
<span id="cb33-24"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-24" tabindex="-1"></a></span>
<span id="cb33-25"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-25" tabindex="-1"></a><span class="co"># Save data</span></span>
<span id="cb33-26"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-26" tabindex="-1"></a><span class="fu">write_csv</span>(</span>
<span id="cb33-27"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-27" tabindex="-1"></a>  data_mae,</span>
<span id="cb33-28"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-28" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;results/climate/data_gam_comparison_mae.csv&quot;</span></span>
<span id="cb33-29"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb33-29" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="gam-predictions-at-survey-sites" class="section level2 hasAnchor" number="3.13">
<h2><span class="header-section-number">3.13</span> GAM predictions at survey sites<a href="building-and-validating-semi-spatial-gams-for-climate.html#gam-predictions-at-survey-sites" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we get the spatial-climate model predictions at the modern survey site locations (called ‘survey sites’).
This is a repitition of the steps above for the much smaller subset of survery sites.
Recall that for each survey site, there will be three candidate model predictions for each climate variable in each season.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-1" tabindex="-1"></a><span class="co"># Read survey sites from a local file</span></span>
<span id="cb34-2"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-2" tabindex="-1"></a>survey_sites <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/list-of-resurvey-locations.csv&quot;</span>)</span>
<span id="cb34-3"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-3" tabindex="-1"></a><span class="fu">names</span>(survey_sites)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb34-4"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-4" tabindex="-1"></a><span class="fu">names</span>(survey_sites)[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb34-5"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-5" tabindex="-1"></a></span>
<span id="cb34-6"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-6" tabindex="-1"></a><span class="co"># Sample BIOCLIM rasters at survey sites</span></span>
<span id="cb34-7"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-7" tabindex="-1"></a>survey_sites <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb34-8"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-8" tabindex="-1"></a>  survey_sites,</span>
<span id="cb34-9"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-9" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">extract</span>(</span>
<span id="cb34-10"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-10" tabindex="-1"></a>    <span class="fu">c</span>(chelsa_t_mean, chelsa_ppt_sum),</span>
<span id="cb34-11"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-11" tabindex="-1"></a>    survey_sites[, <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)]</span>
<span id="cb34-12"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-12" tabindex="-1"></a>  )</span>
<span id="cb34-13"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-13" tabindex="-1"></a>)</span>
<span id="cb34-14"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-14" tabindex="-1"></a></span>
<span id="cb34-15"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-15" tabindex="-1"></a><span class="co"># Remove survery site id, keeping only the &#39;modern_site_code&#39;</span></span>
<span id="cb34-16"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-16" tabindex="-1"></a>survey_sites <span class="ot">&lt;-</span> <span class="fu">select</span>(</span>
<span id="cb34-17"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-17" tabindex="-1"></a>  survey_sites,</span>
<span id="cb34-18"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-18" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">c</span>(site_name, historical_site_code, modern_landCover_type, ID)</span>
<span id="cb34-19"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-19" tabindex="-1"></a>)</span>
<span id="cb34-20"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-20" tabindex="-1"></a></span>
<span id="cb34-21"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-21" tabindex="-1"></a><span class="co"># Pivot the data to long format and identify the season and climate</span></span>
<span id="cb34-22"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-22" tabindex="-1"></a><span class="co"># variable from the variable name (this is autogenerated by `terra::extract()`)</span></span>
<span id="cb34-23"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-23" tabindex="-1"></a>survey_sites <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb34-24"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-24" tabindex="-1"></a>  survey_sites,</span>
<span id="cb34-25"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-25" tabindex="-1"></a>  <span class="at">cols =</span> <span class="sc">!</span><span class="fu">c</span>(<span class="st">&quot;modern_site_code&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb34-26"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-26" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb34-27"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-27" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-28"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-28" tabindex="-1"></a>    <span class="at">season =</span> <span class="fu">str_extract</span>(</span>
<span id="cb34-29"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-29" tabindex="-1"></a>      name,</span>
<span id="cb34-30"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-30" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">&quot;dry|rainy&quot;</span></span>
<span id="cb34-31"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-31" tabindex="-1"></a>    ),</span>
<span id="cb34-32"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-32" tabindex="-1"></a>    <span class="at">climvar =</span> <span class="fu">str_extract</span>(</span>
<span id="cb34-33"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-33" tabindex="-1"></a>      name,</span>
<span id="cb34-34"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-34" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">&quot;temp|ppt&quot;</span></span>
<span id="cb34-35"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-35" tabindex="-1"></a>    ),</span>
<span id="cb34-36"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-36" tabindex="-1"></a>    <span class="at">climvar =</span> <span class="fu">if_else</span>(</span>
<span id="cb34-37"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-37" tabindex="-1"></a>      climvar <span class="sc">==</span> <span class="st">&quot;temp&quot;</span>, <span class="st">&quot;t_mean&quot;</span>, <span class="st">&quot;ppt&quot;</span></span>
<span id="cb34-38"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-38" tabindex="-1"></a>    )</span>
<span id="cb34-39"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-39" tabindex="-1"></a>  )</span>
<span id="cb34-40"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-40" tabindex="-1"></a></span>
<span id="cb34-41"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-41" tabindex="-1"></a><span class="co"># Nest data, and remove the linked rasters</span></span>
<span id="cb34-42"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-42" tabindex="-1"></a>survey_sites <span class="ot">&lt;-</span> <span class="fu">nest</span>(</span>
<span id="cb34-43"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-43" tabindex="-1"></a>  survey_sites,</span>
<span id="cb34-44"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-44" tabindex="-1"></a>  <span class="at">chelsa =</span> <span class="sc">!</span><span class="fu">c</span>(<span class="st">&quot;season&quot;</span>, <span class="st">&quot;climvar&quot;</span>)</span>
<span id="cb34-45"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-45" tabindex="-1"></a>)</span>
<span id="cb34-46"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-46" tabindex="-1"></a>data_pred <span class="ot">&lt;-</span> <span class="fu">select</span>(data_pred, <span class="sc">-</span>chelsa) <span class="co"># remove rasters as data extracted</span></span>
<span id="cb34-47"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-47" tabindex="-1"></a></span>
<span id="cb34-48"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-48" tabindex="-1"></a><span class="co"># Link survey data coordinates with model prediction data</span></span>
<span id="cb34-49"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-49" tabindex="-1"></a>survey_sites <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb34-50"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-50" tabindex="-1"></a>  survey_sites,</span>
<span id="cb34-51"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-51" tabindex="-1"></a>  data_pred</span>
<span id="cb34-52"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-52" tabindex="-1"></a>)</span>
<span id="cb34-53"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-53" tabindex="-1"></a></span>
<span id="cb34-54"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-54" tabindex="-1"></a><span class="co"># For each survey site location, extract model-predicted values from</span></span>
<span id="cb34-55"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-55" tabindex="-1"></a><span class="co"># the model-prediction rasters</span></span>
<span id="cb34-56"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-56" tabindex="-1"></a>survey_sites <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb34-57"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-57" tabindex="-1"></a>  survey_sites,</span>
<span id="cb34-58"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-58" tabindex="-1"></a>  <span class="at">chelsa =</span> <span class="fu">map2</span>(chelsa, mean_pred, <span class="cf">function</span>(ch, pr) {</span>
<span id="cb34-59"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-59" tabindex="-1"></a>    ch <span class="sc">|&gt;</span></span>
<span id="cb34-60"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-60" tabindex="-1"></a>      <span class="fu">rename</span>(</span>
<span id="cb34-61"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-61" tabindex="-1"></a>        <span class="at">bioclim_val =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb34-62"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-62" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb34-63"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-63" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb34-64"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-64" tabindex="-1"></a>        <span class="at">pred_val =</span> terra<span class="sc">::</span><span class="fu">extract</span>(pr, ch[, <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)])<span class="sc">$</span>lyr1</span>
<span id="cb34-65"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-65" tabindex="-1"></a>        <span class="co"># the naming doesn&#39;t quite work</span></span>
<span id="cb34-66"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-66" tabindex="-1"></a>      )</span>
<span id="cb34-67"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-67" tabindex="-1"></a>  })</span>
<span id="cb34-68"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-68" tabindex="-1"></a>)</span>
<span id="cb34-69"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-69" tabindex="-1"></a></span>
<span id="cb34-70"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-70" tabindex="-1"></a><span class="co"># Convert the model forumlae in the data to characters and unnest the</span></span>
<span id="cb34-71"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-71" tabindex="-1"></a><span class="co"># CHELSA data</span></span>
<span id="cb34-72"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-72" tabindex="-1"></a>survey_sites <span class="ot">&lt;-</span> survey_sites <span class="sc">|&gt;</span></span>
<span id="cb34-73"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-73" tabindex="-1"></a>  <span class="fu">select</span>(season, climvar, chelsa, forms) <span class="sc">|&gt;</span></span>
<span id="cb34-74"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-74" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-75"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-75" tabindex="-1"></a>    <span class="at">forms =</span> <span class="fu">as.character</span>(forms)</span>
<span id="cb34-76"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-76" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-77"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-77" tabindex="-1"></a>  <span class="fu">unnest</span>(</span>
<span id="cb34-78"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-78" tabindex="-1"></a>    <span class="at">cols =</span> chelsa</span>
<span id="cb34-79"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-79" tabindex="-1"></a>  )</span>
<span id="cb34-80"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-80" tabindex="-1"></a></span>
<span id="cb34-81"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-81" tabindex="-1"></a><span class="co"># Save the CHELSA and predicted measures at survey sites</span></span>
<span id="cb34-82"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-82" tabindex="-1"></a><span class="fu">write_csv</span>(</span>
<span id="cb34-83"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-83" tabindex="-1"></a>  survey_sites,</span>
<span id="cb34-84"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-84" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;results/climate/data_gam_compare_survey_sites.csv&quot;</span></span>
<span id="cb34-85"><a href="building-and-validating-semi-spatial-gams-for-climate.html#cb34-85" tabindex="-1"></a>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="preparing-historical-climate-data-and-geographical-covariates.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="building-a-correction-layer-for-climate-predictions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vjjan91/nilgiris-resurvey-project/edit/master/02_semi-spatial-gam-climate.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
